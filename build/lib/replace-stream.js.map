{"version":3,"sources":["../../src/lib/replace-stream.js"],"names":["LOG","createReplaceStream","toc","s","re","replacement","match","table","t","trim","res","JSON","parse","header","rows","a","getRow","map","length","repeat","join","err","row"],"mappings":";;;;;;;AAAA;;AACA;;AAEA,MAAMA,MAAM,oBAAS,KAAT,CAAZ;AAEA;;;;;AAIe,SAASC,mBAAT,CAA6BC,MAAM,EAAnC,EAAuC;AACpD,QAAMC,IAAI,6BAAc,CACtB;AACEC,QAAI,WADN;AAEEC,iBAAaH;AAFf,GADsB,EAKtB;AACEE,QAAI,qBADN;;AAEEC,kBAAc;AACZL,UAAI,mBAAJ;AACA,aAAO,EAAP;AACD;;AALH,GALsB,EAYtB;AACEI,QAAI,wBADN;;AAEEC,gBAAYC,KAAZ,EAAmBC,KAAnB,EAA0B;AACxB,YAAMC,IAAID,MAAME,IAAN,EAAV;;AACA,UAAI;AACF,cAAMC,MAAMC,KAAKC,KAAL,CAAWJ,CAAX,CAAZ;AACA,cAAM,CAACK,MAAD,EAAS,GAAGC,IAAZ,IAAoBJ,GAA1B;AACA,cAAMK,IAAI,CACRC,OAAOH,MAAP,CADQ,EAERG,OAAOH,OAAOI,GAAP,CAAW,CAAC;AAAEC;AAAF,SAAD,KAAgB,IAAIC,MAAJ,CAAWD,MAAX,CAA3B,CAAP,CAFQ,EAGR,GAAGJ,KAAKG,GAAL,CAASD,MAAT,CAHK,CAAV;AAKA,eAAOD,EAAEK,IAAF,CAAO,IAAP,CAAP;AACD,OATD,CASE,OAAOC,GAAP,EAAY;AACZrB,YAAI,2BAAJ;AACA,eAAOM,KAAP;AACD;AACF;;AAjBH,GAZsB,CAAd,CAAV;AAgCA,SAAOH,CAAP;AACD;;AAGD,MAAMa,SAAUM,GAAD,IAAS;AACtB,QAAMnB,IAAK,KAAImB,IAAIF,IAAJ,CAAS,KAAT,CAAgB,IAA/B;AACA,SAAOjB,CAAP;AACD,CAHD","sourcesContent":["import { replaceStream } from 'restream'\nimport { debuglog } from 'util'\n\nconst LOG = debuglog('doc')\n\n/**\n *\n * @param {string} [toc] The table of contents.\n */\nexport default function createReplaceStream(toc = '') {\n  const s = replaceStream([\n    {\n      re: /^%TOC%$/gm,\n      replacement: toc,\n    },\n    {\n      re: /<!--[\\s\\S]*?-->\\n*/g,\n      replacement() {\n        LOG('stripping comment')\n        return ''\n      },\n    },\n    {\n      re: /```table([\\s\\S]+?)```/g,\n      replacement(match, table) {\n        const t = table.trim()\n        try {\n          const res = JSON.parse(t)\n          const [header, ...rows] = res\n          const a = [\n            getRow(header),\n            getRow(header.map(({ length }) => '-'.repeat(length))),\n            ...rows.map(getRow),\n          ]\n          return a.join('\\n')\n        } catch (err) {\n          LOG('could not parse the table')\n          return match\n        }\n      },\n    },\n  ])\n  return s\n}\n\n\nconst getRow = (row) => {\n  const s = `| ${row.join(' | ')} |`\n  return s\n}\n"],"file":"replace-stream.js"}