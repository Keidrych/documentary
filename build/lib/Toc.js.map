{"version":3,"sources":["../../src/lib/Toc.js"],"names":[],"mappings":"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","file":"lib/Toc.js","sourcesContent":["import { Transform } from 'stream'\nimport { collect } from 'catchment'\nimport { getLink } from '.'\nimport { methodTitleRe, replaceTitle } from './rules/method-title'\nimport {\n  codeRe, commentRule as stripComments, innerCodeRe, linkTitleRe,\n} from './rules'\nimport {\n  Replaceable, makeCutRule, makePasteRule, makeMarkers,\n} from 'restream'\nimport { tableRe } from './rules/table'\nimport typeRule from './rules/type'\nimport typedefMdRule from './rules/typedef-md'\n\nconst re = /(?:^|\\n) *(#+) +(.+)/g\n\nconst underline = /^ *([=-]+) *$/gm\n\nconst getBuffer = async (buffer) => {\n  const {\n    title, methodTitle, code, innerCode, table, linkTitle,\n  } = makeMarkers({\n    title: /^ *#+.+/gm,\n    methodTitle: methodTitleRe,\n    code: codeRe,\n    innerCode: innerCodeRe,\n    table: tableRe,\n    linkTitle: linkTitleRe,\n  })\n\n  const [\n    cutTitle, cutLinkTitle, cutCode, cutMethodTitle,\n    cutInnerCode, cutTable,\n  ] =\n    [title, linkTitle, code, methodTitle, innerCode, table].map((marker) => {\n      const rule = makeCutRule(marker)\n      return rule\n    })\n  const [\n    insertTitle, insertLinkTitle, insertMethodTitle, insertTable,\n  ] =\n    [title, linkTitle, methodTitle, table].map((marker) => {\n      const rule = makePasteRule(marker)\n      return rule\n    })\n\n  const rs = new Replaceable([\n    cutInnerCode, // this ensures no link titles are detected inside of inner code\n    // cutTitle, // i don't know why we are doing this\n    // cutLinkTitle,\n\n    // make sure those are not cut with code\n    cutTable,\n    cutMethodTitle,\n\n    // never pasted back\n    cutCode,\n    stripComments,\n\n    // types will add link titles\n    typedefMdRule,\n    typeRule,\n\n    // paste those cut out earlier.\n    insertMethodTitle,\n    insertTable,\n\n    // insertLinkTitle,\n    // insertTitle,\n    // {\n    //   re: /[\\s\\S]*/,\n    //   replacement(match) {\n    //     debugger\n    //     return match\n    //   },\n    // },\n  ])\n  rs.end(buffer)\n  const b = await collect(rs)\n  // console.log(underlined.map)\n  return { b, innerCode }\n}\n\nexport default class Toc extends Transform {\n  /**\n   * A transform stream which will extract the titles in the markdown document and transform them into a markdown nested list with links.\n   * @param {Config} [config] Configuration object.\n   * @param {boolean} [config.skipLevelOne=true] Don't use the first title in the TOC (default `true`).\n   */\n  constructor(config = {}) {\n    const {\n      skipLevelOne = true,\n    } = config\n    super()\n    this.skipLevelOne = skipLevelOne\n    this.level = 0\n    this.titles = []\n  }\n\n  addTitle({ title, link, position, level, parentLevel }) {\n    this.titles.push({\n      title, link, position, level, parentLevel,\n    })\n  }\n\n  getTocLine({ title, link, level }) {\n    const heading = `[${title}](#${link})`\n    let s\n    const lvl = this.skipLevelOne ? level - 1 : level\n    if (lvl == 1) {\n      s = `- ${heading}`\n    } else {\n      const p = '  '.repeat(Math.max(lvl - 1, 0))\n      s = `${p}* ${heading}`\n    }\n    const ts = s.trimRight()\n    return ts\n  }\n\n  skipLine(level) {\n    return this.skipLevelOne && level == 1\n  }\n\n  async _transform(buffer, enc, next) {\n    const { b, innerCode } = await getBuffer(buffer)\n\n    const getTitle = (title) => {\n      const t = title.replace(innerCode.regExp, (m, i) => {\n        const val = innerCode.map[i]\n        return val\n      })\n      return t\n    }\n\n    const replaceable = new Replaceable([\n      {\n        re: underline,\n        replacement: (match, u, position, input) => {\n          const level = u.indexOf('-') + 2 // either 0 or -1\n          if (this.skipLine(level)) return match\n          const lines = []\n          let ok = true\n          let s = input.substr(0, position - 1)\n          while (ok) {\n            const li = s.lastIndexOf('\\n')\n            const t = s.substr(li + 1)\n            const isLine = new RegExp(underline.source).test(t)\n            if (isLine) {\n              break\n            }\n            ok = /^ *(?!\\s*(?:>|(?:[+*-] )|(?:\\d+\\.)|(?:# )|`{3,}))[^\\s]+.*$/.test(t)\n            if (ok) {\n              lines.unshift(t)\n              s = s.substr(0, s.length - t.length - 1)\n            } else {\n              break\n            }\n          }\n          const title = `${lines.map(l => l.trim()).join('<br/>')}`\n          const t = getTitle(title)\n          const link = getLink(t)\n          this.addTitle({\n            title: t, link, level, position,\n          })\n          return match\n        },\n      },\n      {\n        re,\n        replacement: (match, { length: level }, title, position) => {\n          if (this.skipLine(level)) return match\n          const t = getTitle(title)\n\n          this.addTitle({\n            title: t,\n            link: getLink(t),\n            position,\n            level,\n          })\n          return match\n        },\n      },\n      {\n        re: methodTitleRe,\n        replacement: (match, hash, isAsync, name, returnType, jsonArgs, position) => {\n          try {\n            const { length: level } = hash\n\n            if (this.skipLine(level)) return match\n            const json = jsonArgs ? jsonArgs : '[]'\n            const bb = [isAsync, name]\n              .filter(a => a)\n              .join(' ').trim()\n            const args = JSON.parse(json)\n            const s = args.map(([argName, type, shortType]) => {\n              let tt\n              if (shortType) tt = shortType\n              else if (typeof type == 'string') tt = type\n              else tt = 'object'\n              return `${argName}: ${tt}`\n            })\n            const fullTitle = replaceTitle(hash, isAsync, name, returnType, jsonArgs)\n              .replace(/^#+ +/, '')\n            const link = getLink(fullTitle)\n\n            const rt = `${returnType ? `: ${returnType}` : ''}`\n            const title = `\\`${bb}(${s.join(', ')})${rt}\\``\n            this.addTitle({\n              title,\n              link,\n              position,\n              level,\n            })\n          } catch (err) {\n            // ok\n            return match\n          }\n        },\n      },\n      {\n        re: linkTitleRe,\n        replacement: (match, title, l, position) => {\n          const t = getTitle(title)\n          const link = getLink(t)\n          this.addTitle({\n            title: t,\n            ...(l == 't' ? { parentLevel: true } : { level: l.length }),\n            link,\n            position,\n          })\n          return match\n        },\n      },\n    ])\n    replaceable.end(b)\n    await collect(replaceable)\n    const sorted = this.sortTitles()\n    sorted.forEach((title) => {\n      if (title.parentLevel) {\n        title.level = this.level + 1\n      } else {\n        this.level = title.level\n      }\n      const line = this.getTocLine(title)\n      this.push(line)\n      this.push('\\n')\n    })\n    this.clear()\n    next()\n  }\n  clear() {\n    this.titles = []\n  }\n  sortTitles() {\n    const sorted = this.titles.sort(({ position: A }, { position: B }) => {\n      if (A > B) return 1\n      if (A < B) return -1\n      return 0\n    })\n    return sorted\n  }\n}\n\nexport const getToc = async (stream, h1) => {\n  const toc = new Toc({ skipLevelOne: !h1 })\n  stream.pipe(toc)\n  const res = await collect(toc)\n  return res.trimRight()\n}\n\n/**\n * @typedef {Object} Config\n * @property {boolean} [skipLevelOne=true] Don't use the first title in the TOC (default `true`).\n */\n"]}