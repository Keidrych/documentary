{"version":3,"sources":["../../../src/lib/rules/fork.js"],"names":[],"mappings":"AAAA,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,YAAY;;;;;AAKlC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;EACf,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACpC,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;IACrC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAClC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;MAClC,QAAQ,CAAC,CAAC,CAAC,CAAC;MACZ,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;IACf,CAAC;IACD,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;IACjC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;IAC3B,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG;IACnC,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,YAAY;EAC7C,CAAC;AACH;;AAEA,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;EAC3D,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACtC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACxC;;AAEA,MAAM,CAAC,OAAO,CAAC","file":"lib/rules/fork.js","sourcesContent":["import { fork } from 'spawncommand'\n// import { debuglog } from 'util'\n\n// const LOG = debuglog('doc')\n\nconst forkRule = {\n  re: /%FORK(ERR)?(?:-(\\w+))? (.+)%/mg,\n  async replacement(match, err, lang, m) {\n    const [mod, ...args] = m.split(' ')\n    const { promise } = fork(mod, args, {\n      execArgv: [],\n      stdio: 'pipe',\n    })\n    const { stdout, stderr } = await promise\n    const res = err ? stderr : stdout\n    const hasBackticks = /```/.test(res)\n    return codeSurround(res, lang, hasBackticks)\n  },\n}\n\nconst codeSurround = (m, lang = '', hasBackticks = false) => {\n  const t = hasBackticks ? '````' : '```'\n  return `${t}${lang}\\n${m.trim()}\\n${t}`\n}\n\nexport default forkRule\n"]}