{"version":3,"sources":["../../../src/lib/rules/type.js"],"names":["LOG","typeRe","execRes","re","s","res","exec","args","extractProps","propsRe","t","r","key","value","push","getPropValue","tt","replace","trim","split","filter","a","reduce","k","acc","val","test","parseInt","extractTag","tag","string","RegExp","length","_p","_c","p","props","item","content","strong","makeTable","properties","tocTitles","rows","map","name","type","required","description","example","n","nn","join","typeRule","replacement","match","body","tags","table","err","message"],"mappings":"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","sourcesContent":["import { debuglog } from 'util'\n\nconst LOG = debuglog('doc')\n\n// `%TYPE Name\n// <p>\n// </p>\n// <p>\n// </p>\n// %`\n\nconst typeRe = /^%TYPE( .+)?\\n([\\s\\S]+)\\n%$/mg\n\nexport { typeRe }\n\n\nconst execRes = (re, s) => {\n  const res = re.exec(s)\n  if (!res) return res\n  const [, ...args] = res\n  return args\n}\nconst extractProps = (s) => {\n  const propsRe = /(\\w+)=\"(.*?)\"/g\n  let t\n  const r = []\n  while ((t = propsRe.exec(s)) !== null) {\n    const [, key, value] = t\n    r.push({\n      key,\n      value: getPropValue(value),\n    })\n  }\n  const tt = s.replace(propsRe, '').trim().split(' ')\n    .filter(a => a)\n    .reduce((a, k) => ({ ...a, [k]: true }), {})\n  return r.reduce((acc, { key, value }) => ({\n    ...acc,\n    [key]: value,\n  }), tt)\n}\n\nconst getPropValue = (val) => {\n  if (val == 'true') return true\n  if (val == 'false') return false\n  if (/^\\d+$/.test(val)) {\n    return parseInt(val, 10)\n  }\n  return val\n}\n\nexport const extractTag = (tag, string) => {\n  const re = new RegExp(`<${tag}( .[^>]+)?(?: /)?>(?:([\\\\s\\\\S]+?)</${tag}>)?`, 'g')\n  const r = []\n\n  let t\n  while ((t = execRes(re, string)) !== null) {\n    if (!t.length) continue\n    const [_p = '', _c = ''] = t\n    const p = _p.replace(/\\/$/, '').trim()\n    const props = extractProps(p)\n    const item = {\n      props,\n      content: _c,\n    }\n    r.push(item)\n  }\n  return r\n}\n\nconst tag = (t, s) => `<${t}>${s}</${t}>`\nconst strong = s => tag('strong', s)\n\nconst makeTable = (properties, tocTitles) => {\n  const rows = properties.map(({ name, type, required, description = '', example = '' }) => {\n    const t = `<code>${name}</code>`\n    const n = required ? strong(t) : t\n    const nn = tocTitles ? `[${n}](t)` : n\n    return `\n<tr>\n  <td>${nn}</td>\n\n  <td>${tag('em', type)}</td>\n  <td>${description}</td>\n  <td>\n\n${example}\n  </td>\n</tr>`\n  })\n  return `<table>\n  <tr>\n    <th>Property</th>\n    <th>Type</th>\n    <th>Description</th>\n    <th>Example</th>\n  </tr>\n  ${rows.join('\\n')}\n</table>\n`\n}\n\nconst typeRule = {\n  re: typeRe,\n  replacement(match, tocTitles, body) {\n    try {\n      const tags = extractTag('p', body)\n        .map(({ content, props }) => {\n          const [{ content: description } = {}] = extractTag('d', content)\n          const [{ content: example } = {}] = extractTag('e', content)\n          return {\n            description,\n            example,\n            ...props,\n          }\n        })\n      const table = makeTable(tags, tocTitles)\n      return table\n    } catch (err) {\n      LOG('Could not parse type, %s', err.message)\n      return match\n    }\n  },\n}\n\n// const b = (summary, alt, gif) => {\n//   return `\n// <details>\n//   <summary>${summary}</summary>\n//   <table>\n//   <tr><td>\n//     <img alt=\"${alt}\" src=\"${gif}\" />\n//   </td></tr>\n//   </table>\n// </details>\n// `.trim()\n// }\n\nexport default typeRule\n"],"file":"type.js"}