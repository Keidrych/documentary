{"version":3,"sources":["../../src/bin/index.js"],"names":["LOG","DEBUG","test","process","env","NODE_DEBUG","source","_source","output","_output","toc","_toc","watch","_watch","push","_push","typedef","_typedef","version","_version","extract","_extract","console","log","exit","argv","find","a","err","message","doc","justToc","Error","stream","stack","code","debounce","recursive"],"mappings":"AAAA;;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,MAAM,oBAAS,KAAT,CAAZ;AACA,MAAMC,QAAQ,MAAMC,IAAN,CAAWC,QAAQC,GAAR,CAAYC,UAAvB,CAAd;AAEA,MAAM;AACJC,UAAQC,OADJ;AAEJC,UAAQC,OAFJ;AAGJC,OAAKC,IAHD;AAIJC,SAAOC,MAJH;AAKJC,QAAMC,KALF;AAMJC,WAASC,QANL;AAOJC,WAASC,QAPL;AAQJC,WAASC;AARL,IASF,uBATJ;;AAWA,IAAIF,QAAJ,EAAc;AACZG,UAAQC,GAAR,CAAYL,gBAAZ;AACAf,UAAQqB,IAAR,CAAa,CAAb;AACD;;AAED,IAAIrB,QAAQsB,IAAR,CAAaC,IAAb,CAAkBC,KAAKA,KAAK,IAA5B,KAAqC,CAACZ,KAA1C,EAAiD;AAC/C,wBAAQ,kCAAR;AACD;;AACD,IAAIZ,QAAQsB,IAAR,CAAaC,IAAb,CAAkBC,KAAKA,KAAK,IAA5B,KAAqC,CAACN,QAA1C,EAAoD;AAClD,wBAAQ,2CAAR;AACD;;AAED,IAAId,OAAJ,EAAa;AACX,MAAI;AACF,uBAAUA,OAAV;AACD,GAFD,CAEE,OAAOqB,GAAP,EAAY;AACZ,QAAIA,IAAIC,OAAR,EAAiBD,IAAIC,OAAJ,GAAe,wBAAuBtB,OAAQ,KAAIqB,IAAIC,OAAQ,EAA9D;AACjB,0BAAQD,GAAR;AACD;AACF;;AAED,MAAME,MAAM,OAAOxB,MAAP,EAAeE,MAAf,EAAuBuB,UAAU,KAAjC,KAA2C;AACrD,MAAI,CAACzB,MAAL,EAAa;AACX,UAAM,IAAI0B,KAAJ,CAAU,+BAAV,CAAN;AACD;;AACD,QAAMC,SAAS,oBAAU3B,MAAV,CAAf;AACA,QAAM,kBAAI2B,MAAJ,EAAYzB,MAAZ,EAAoBuB,OAApB,CAAN;AACD,CAND;;AAQA,CAAC,YAAY;AACX,MAAIV,QAAJ,EAAc;AACZ,UAAM,uBAAW;AACff,cAAQC,OADO;AAEfa,eAASC;AAFM,KAAX,CAAN;AAIA;AACD;;AACD,MAAIJ,QAAJ,EAAc;AACZ,UAAM,iBAAM;AACVX,cAAQC,OADE;AAEVC,cAAQC;AAFE,KAAN,CAAN;AAIA;AACD;;AACD,MAAI;AACF,UAAMqB,IAAIvB,OAAJ,EAAaE,OAAb,EAAsBE,IAAtB,CAAN;AACD,GAFD,CAEE,OAAO;AAAEuB,SAAF;AAASL,WAAT;AAAkBM;AAAlB,GAAP,EAAiC;AACjClC,YAAQD,IAAIkC,KAAJ,CAAR,GAAqBZ,QAAQC,GAAR,CAAYM,OAAZ,CAArB;AACD;;AAED,MAAIO,WAAW,KAAf;;AACA,MAAIvB,UAAUE,KAAd,EAAqB;AACnB;AACA,mBAAMR,OAAN,EAAe;AAAE8B,iBAAW;AAAb,KAAf,EAAoC,YAAY;AAC9C,UAAI,CAACD,QAAL,EAAe;AACbA,mBAAW,IAAX;AACA,cAAMN,IAAIvB,OAAJ,EAAaE,OAAb,EAAsBE,IAAtB,CAAN;;AACA,YAAII,KAAJ,EAAW;AACTO,kBAAQC,GAAR,CAAY,gCAAZ;AACA,gBAAM,kBAAQhB,OAAR,EAAiBE,OAAjB,EAA0BM,KAA1B,CAAN;AACD;;AACDqB,mBAAW,KAAX;AACD;AACF,KAVD;AAWD;AACF,CApCD","sourcesContent":["#!/usr/bin/env node\nimport { watch } from 'fs'\nimport { debuglog } from 'util'\nimport { lstatSync } from 'fs'\nimport run from './run'\nimport getArgs from './get-args'\nimport runJs from './run/js'\nimport runExtract from './run/extract'\nimport { version } from '../../package.json'\nimport catcher from './catcher'\nimport { getStream, gitPush } from '../lib'\n\nconst LOG = debuglog('doc')\nconst DEBUG = /doc/.test(process.env.NODE_DEBUG)\n\nconst {\n  source: _source,\n  output: _output,\n  toc: _toc,\n  watch: _watch,\n  push: _push,\n  typedef: _typedef,\n  version: _version,\n  extract: _extract,\n} = getArgs()\n\nif (_version) {\n  console.log(version)\n  process.exit(0)\n}\n\nif (process.argv.find(a => a == '-p') && !_push) {\n  catcher('Please specify a commit message.')\n}\nif (process.argv.find(a => a == '-e') && !_extract) {\n  catcher('Please specify where to extract typedefs.')\n}\n\nif (_source) {\n  try {\n    lstatSync(_source)\n  } catch (err) {\n    if (err.message) err.message = `Could not read input ${_source}: ${err.message}`\n    catcher(err)\n  }\n}\n\nconst doc = async (source, output, justToc = false) => {\n  if (!source) {\n    throw new Error('Please specify an input file.')\n  }\n  const stream = getStream(source)\n  await run(stream, output, justToc)\n}\n\n(async () => {\n  if (_extract) {\n    await runExtract({\n      source: _source,\n      extract: _extract,\n    })\n    return\n  }\n  if (_typedef) {\n    await runJs({\n      source: _source,\n      output: _output,\n    })\n    return\n  }\n  try {\n    await doc(_source, _output, _toc)\n  } catch ({ stack, message, code }) {\n    DEBUG ? LOG(stack) : console.log(message)\n  }\n\n  let debounce = false\n  if (_watch || _push) {\n    // also watch referenced example files.\n    watch(_source, { recursive: true }, async () => {\n      if (!debounce) {\n        debounce = true\n        await doc(_source, _output, _toc)\n        if (_push) {\n          console.log('Pushing documentation changes.')\n          await gitPush(_source, _output, _push)\n        }\n        debounce = false\n      }\n    })\n  }\n})()\n"],"file":"index.js"}