{"version":3,"sources":["../../src/bin/run.js"],"names":["LOG","replaceFile","path","toc","out","rs","s","ws","process","stdout","pipe","on","console","log","run","t","exit"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,MAAM,oBAAS,KAAT,CAAZ;;AAEA,MAAMC,cAAc,CAACC,IAAD,EAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACtC,QAAMC,KAAK,0BAAiBH,IAAjB,CAAX;AAEA,QAAMI,IAAI,4BAAoBH,GAApB,CAAV;AAEA,QAAMI,KAAKH,MAAM,2BAAkBA,GAAlB,CAAN,GAA+BI,QAAQC,MAAlD;AAEAJ,KAAGK,IAAH,CAAQJ,CAAR,EAAWI,IAAX,CAAgBH,EAAhB;;AACA,MAAIH,GAAJ,EAAS;AACPG,OAAGI,EAAH,CAAM,OAAN,EAAe,MAAM;AACnBC,cAAQC,GAAR,CAAY,kBAAZ,EAAgCT,GAAhC,EAAqCF,IAArC;AACD,KAFD;AAGD;AACF,CAbD;AAeA;;;;;;;;AAMe,eAAeY,GAAf,CAAmBZ,IAAnB,EAAyBE,GAAzB,EAA8BD,GAA9B,EAAmC;AAChDH,MAAI,YAAJ,EAAkBE,IAAlB;AACA,QAAMa,IAAI,MAAM,iBAAOb,IAAP,CAAhB;;AACA,MAAIC,GAAJ,EAAS;AACPS,YAAQC,GAAR,CAAYE,CAAZ;AACAP,YAAQQ,IAAR;AACD;;AAEDf,cAAYC,IAAZ,EAAkBa,CAAlB,EAAqBX,GAArB;AACD","sourcesContent":["import { getToc } from '../lib/Toc'\nimport { debuglog } from 'util'\nimport { createReadStream, createWriteStream } from 'fs'\nimport createReplaceStream from '../lib/replace-stream'\n\nconst LOG = debuglog('doc')\n\nconst replaceFile = (path, toc, out) => {\n  const rs = createReadStream(path)\n\n  const s = createReplaceStream(toc)\n\n  const ws = out ? createWriteStream(out) : process.stdout\n\n  rs.pipe(s).pipe(ws)\n  if (out) {\n    ws.on('close', () => {\n      console.log('Saved %s from %s', out, path)\n    })\n  }\n}\n\n/**\n * @param {string} path\n * @param {string} [out]\n * @param {string} [out]\n * @param {boolean} [toc]\n */\nexport default async function run(path, out, toc) {\n  LOG('reading %s', path)\n  const t = await getToc(path)\n  if (toc) {\n    console.log(t)\n    process.exit()\n  }\n\n  replaceFile(path, t, out)\n}\n"],"file":"run.js"}