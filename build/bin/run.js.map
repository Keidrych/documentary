{"version":3,"sources":["../../src/bin/run.js"],"names":["LOG","replaceFile","path","toc","out","rs","s","ws","process","stdout","pipe","on","console","log","getToc","md","Toc","promise","Catchment","t","trim","run","exit"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,MAAM,oBAAS,KAAT,CAAZ;;AAEA,MAAMC,cAAc,CAACC,IAAD,EAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACtC,QAAMC,KAAK,0BAAiBH,IAAjB,CAAX;AAEA,QAAMI,IAAI,4BAAoBH,GAApB,CAAV;AAEA,QAAMI,KAAKH,MAAM,2BAAkBA,GAAlB,CAAN,GAA+BI,QAAQC,MAAlD;AAEAJ,KAAGK,IAAH,CAAQJ,CAAR,EAAWI,IAAX,CAAgBH,EAAhB;;AACA,MAAIH,GAAJ,EAAS;AACPG,OAAGI,EAAH,CAAM,OAAN,EAAe,MAAM;AACnBC,cAAQC,GAAR,CAAY,kBAAZ,EAAgCT,GAAhC,EAAqCF,IAArC;AACD,KAFD;AAGD;AACF,CAbD;;AAeA,MAAMY,SAAS,MAAOZ,IAAP,IAAgB;AAC7B,QAAMa,KAAK,0BAAiBb,IAAjB,CAAX;AACA,QAAMG,KAAK,IAAIW,YAAJ,EAAX;AACAD,KAAGL,IAAH,CAAQL,EAAR;AACA,QAAM;AAAEY;AAAF,MAAc,IAAIC,kBAAJ,CAAc;AAAEb;AAAF,GAAd,CAApB;AACA,QAAMc,IAAI,MAAMF,OAAhB;AACA,SAAOE,EAAEC,IAAF,EAAP;AACD,CAPD;AASA;;;;;;;;AAMe,eAAeC,GAAf,CAAmBnB,IAAnB,EAAyBE,GAAzB,EAA8BD,GAA9B,EAAmC;AAChDH,MAAI,YAAJ,EAAkBE,IAAlB;AACA,QAAMiB,IAAI,MAAML,OAAOZ,IAAP,CAAhB;;AACA,MAAIC,GAAJ,EAAS;AACPS,YAAQC,GAAR,CAAYM,CAAZ;AACAX,YAAQc,IAAR;AACD;;AAEDrB,cAAYC,IAAZ,EAAkBiB,CAAlB,EAAqBf,GAArB;AACD","sourcesContent":["import Toc from '../lib/Toc'\nimport { debuglog } from 'util'\nimport Catchment from 'catchment'\nimport { createWriteStream, createReadStream } from 'fs'\nimport createReplaceStream from '../lib/replace-stream'\n\nconst LOG = debuglog('doc')\n\nconst replaceFile = (path, toc, out) => {\n  const rs = createReadStream(path)\n\n  const s = createReplaceStream(toc)\n\n  const ws = out ? createWriteStream(out) : process.stdout\n\n  rs.pipe(s).pipe(ws)\n  if (out) {\n    ws.on('close', () => {\n      console.log('Saved %s from %s', out, path)\n    })\n  }\n}\n\nconst getToc = async (path) => {\n  const md = createReadStream(path)\n  const rs = new Toc()\n  md.pipe(rs)\n  const { promise } = new Catchment({ rs })\n  const t = await promise\n  return t.trim()\n}\n\n/**\n * @param {string} path\n * @param {string} [out]\n * @param {string} [out]\n * @param {boolean} [toc]\n */\nexport default async function run(path, out, toc) {\n  LOG('reading %s', path)\n  const t = await getToc(path)\n  if (toc) {\n    console.log(t)\n    process.exit()\n  }\n\n  replaceFile(path, t, out)\n}\n"],"file":"run.js"}