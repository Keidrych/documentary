{"version":3,"sources":["../../src/bin/run.js"],"names":["replaceFile","stream","toc","out","s","ws","process","stdout","pipe","on","console","log","run","justToc","pt","PassThrough","pause","t","exit","resume"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,cAAc,CAACC,MAAD,EAASC,GAAT,EAAcC,GAAd,KAAsB;AACxC,QAAMC,IAAI,4BAAoBF,GAApB,CAAV;AAEA,QAAMG,KAAKF,MAAM,2BAAkBA,GAAlB,CAAN,GAA+BG,QAAQC,MAAlD;AAEAN,SAAOO,IAAP,CAAYJ,CAAZ,EAAeI,IAAf,CAAoBH,EAApB;;AACA,MAAIF,GAAJ,EAAS;AACPE,OAAGI,EAAH,CAAM,OAAN,EAAe,MAAM;AACnBC,cAAQC,GAAR,CAAY,UAAZ,EAAwBR,GAAxB;AACD,KAFD;AAGD;AACF,CAXD;AAaA;;;;;;;AAKe,eAAeS,GAAf,CAAmBX,MAAnB,EAA2BE,GAA3B,EAAgCU,OAAhC,EAAyC;AACtD,QAAMC,KAAK,IAAIC,mBAAJ,EAAX;AACAD,KAAGE,KAAH;AACAf,SAAOO,IAAP,CAAYM,EAAZ;AACA,QAAMG,IAAI,MAAM,iBAAOhB,MAAP,CAAhB;;AACA,MAAIY,OAAJ,EAAa;AACXH,YAAQC,GAAR,CAAYM,CAAZ;AACAX,YAAQY,IAAR;AACD;;AACDJ,KAAGK,MAAH;AACAnB,cAAYc,EAAZ,EAAgBG,CAAhB,EAAmBd,GAAnB;AACD","sourcesContent":["import { getToc } from '../lib/Toc'\nimport { createWriteStream } from 'fs'\nimport createReplaceStream from '../lib/replace-stream'\nimport { PassThrough } from 'stream'\n\nconst replaceFile = (stream, toc, out) => {\n  const s = createReplaceStream(toc)\n\n  const ws = out ? createWriteStream(out) : process.stdout\n\n  stream.pipe(s).pipe(ws)\n  if (out) {\n    ws.on('close', () => {\n      console.log('Saved %s', out)\n    })\n  }\n}\n\n/**\n * @param {Readable} stream A readable stream.\n * @param {string} [out] Path to the output file.\n * @param {boolean} [justToc] Just print the TOC.\n */\nexport default async function run(stream, out, justToc) {\n  const pt = new PassThrough()\n  pt.pause()\n  stream.pipe(pt)\n  const t = await getToc(stream)\n  if (justToc) {\n    console.log(t)\n    process.exit()\n  }\n  pt.resume()\n  replaceFile(pt, t, out)\n}\n"],"file":"run.js"}