{"version":3,"sources":["../../../src/bin/run/js.js"],"names":["runJs","config","source","output","console","log","process","exit","s","rs","pipe","c","Catchment","res","promise","ws","Promise","r","j","on","end","err"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA;;;;;;AAMA,eAAeA,KAAf,CAAqBC,MAArB,EAA6B;AAC3B,QAAM;AACJC,UADI;AAEJC,aAASD;AAFL,MAGFD,MAHJ;;AAIA,MAAI;AACF,QAAI,CAACC,MAAL,EAAa;AACXE,cAAQC,GAAR,CAAY,mCAAZ;AACAC,cAAQC,IAAR,CAAa,CAAb;AACD;;AAED,UAAMC,IAAI,0BAAiBN,MAAjB,CAAV;AACA,UAAMO,KAAK,+BAAX;AACAD,MAAEE,IAAF,CAAOD,EAAP;AACA,UAAME,IAAI,IAAIC,kBAAJ,CAAc;AACtBH;AADsB,KAAd,CAAV;AAGA,UAAMI,MAAM,MAAMF,EAAEG,OAApB;AACA,UAAMC,KAAK,2BAAkBZ,MAAlB,CAAX;AACA,UAAM,IAAIa,OAAJ,CAAY,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC1BH,SAAGI,EAAH,CAAM,OAAN,EAAeD,CAAf,EAAkBE,GAAlB,CAAsBP,GAAtB,EAA2BI,CAA3B;AACD,KAFK,CAAN;AAGAb,YAAQC,GAAR,CAAY,IAAIH,UAAUC,MAAV,GAAmB,CAAC,8BAAD,EAAiCD,MAAjC,CAAnB,GAA8D,CAAC,oBAAD,EAAuBC,MAAvB,CAAlE,CAAZ;AACD,GAlBD,CAkBE,OAAOkB,GAAP,EAAY;AACZ,0BAAQA,GAAR;AACD;AACF;AAED;;;;;;;eAMerB,K","sourcesContent":["import { createWriteStream, createReadStream } from 'fs'\nimport Catchment from 'catchment'\nimport createJsReplaceStream from '../../lib/js-replace-stream'\nimport catcher from '../catcher'\n\n/**\n * Process a JavaScript file to include `@typedef`s found with the `/* documentary types.xml *\\/` marker.\n * @param {Config} config Configuration Object.\n * @param {string} config.source Path to the source JavaScript file.\n * @param {string} [config.output] Path to the source JavaScript file.\n */\nasync function runJs(config) {\n  const {\n    source,\n    output = source,\n  } = config\n  try {\n    if (!source) {\n      console.log('Please specify a JavaScript file.')\n      process.exit(1)\n    }\n\n    const s = createReadStream(source)\n    const rs = createJsReplaceStream()\n    s.pipe(rs)\n    const c = new Catchment({\n      rs,\n    })\n    const res = await c.promise\n    const ws = createWriteStream(output)\n    await new Promise((r, j) => {\n      ws.on('error', j).end(res, r)\n    })\n    console.log(...(source == output ? ['Updated %s to include types.', source] : ['Saved output to %s', output]))\n  } catch (err) {\n    catcher(err)\n  }\n}\n\n/**\n * @typedef {Object} Config\n * @prop {string} source Path to the source JavaScript file.\n * @prop {string} [output] Path to the source JavaScript file.\n */\n\nexport default runJs\n"],"file":"js.js"}